# 噼里啪啦小助手 - EARS语法需求文档

## 项目概述
噼里啪啦小助手：开发一个基于Web的工作流处理器，用户可以文字/文件，通过调用扣子工作流API后输出完整的coze工作流反馈。项目采用科技感风格设计，具备完整的图文展示、复制、下载等功能。

## 技术要求
- **平台**: 纯静态网页，可直接在浏览器运行
- **兼容性**: 移动端优先，响应式设计
- **技术栈**: HTML5 + CSS3 + JavaScript (原生)
- **API集成**: 扣子工作流API (非流式响应)
- **外部依赖**: JSZip库用于批量下载功能

## API配置 (保持不变)

### 当前API配置
```javascript
const COZE_API_CONFIG = {
    baseUrl: 'https://api.coze.cn/v1/workflow/run',
    token: 'pat_ZiVGbB5siln3M8TWCLEvAuq63ugpMc6meCoWe9jTnivP7fzu1g6fPVv5uVPZ1AMi',
    workflowIds: {
        a: '7560945341966483502',
        b: '7553278219114971136',
        c: '7562027540538408996'
    }
};
```

### API规格详细配置

#### 第一个工作流配置
- **接口地址**: `https://api.coze.cn/v1/workflow/run`
- **请求方法**: POST
- **认证方式**: Bearer Token
- **当前Token**: `pat_ZiVGbB5siln3M8TWCLEvAuq63ugpMc6meCoWe9jTnivP7fzu1g6fPVv5uVPZ1AMi`
- **当前工作流ID**: `7560945341966483502` (报价工作流)
- **请求参数格式**:
  ```json
  {
    "workflow_id": "7560945341966483502",
    "parameters": {
      "input": "用户输入的内容"
    }
  }
  ```

#### 第二个工作流配置
- **接口地址**: `https://api.coze.cn/v1/workflow/run`
- **请求方法**: POST
- **认证方式**: Bearer Token
- **当前Token**: `pat_ZiVGbB5siln3M8TWCLEvAuq63ugpMc6meCoWe9jTnivP7fzu1g6fPVv5uVPZ1AMi`
- **当前工作流ID**: `7553278219114971136` (物料查询工作流)
- **请求参数格式**:
  ```json
  {
    "workflow_id": "7553278219114971136",
    "parameters": {
      "input": "用户输入的内容"
    }
  }
  ```

#### 第三个工作流配置 (Excel文件处理工作流)
- **接口地址**: `https://api.coze.cn/v1/workflow/run`
- **请求方法**: POST
- **认证方式**: Bearer Token
- **当前Token**: `pat_ZiVGbB5siln3M8TWCLEvAuq63ugpMc6meCoWe9jTnivP7fzu1g6fPVv5uVPZ1AMi`
- **当前工作流ID**: `7562027540538408996` (报价Excel匹配工作流)
- **功能描述**: 处理Excel文件，进行智能化的报价匹配和数据分析
- **请求参数格式**:
  ```json
  {
    "workflow_id": "7562027540538408996",
    "parameters": {
      "input": "{\"file_id\":\"${file_id}\"}"
    }
  }
  ```

#### 文件上传配置
- **接口地址**：`https://api.coze.cn/v1/files/upload`
- **请求方法**: POST
- **认证方式**: Bearer Token
- **当前Token**: `pat_ZiVGbB5siln3M8TWCLEvAuq63ugpMc6meCoWe9jTnivP7fzu1g6fPVv5uVPZ1AMi`
- **支持文件格式**: .xlsx, .xls (Excel文件)
- **文件大小限制**: 根据Coze API限制
- **响应格式**: 返回文件ID，用于后续工作流调用

## EARS语法功能需求

### 1. 主界面导航系统需求

#### R1.1 主菜单显示需求
**WHEN** 用户访问应用首页 **THEN** 系统应显示卡片式主菜单界面

#### R1.2 工作流入口需求
**WHEN** 主菜单加载完成 **THEN** 系统应显示以下工作流入口卡片：
- "想知道报价吗，点我点我点我！" - 报价工作流入口
- "报价Excel匹配" - Excel文件处理工作流入口
- "简单物料查询" - 物料查询工作流入口

#### R1.3 卡片交互需求
**WHEN** 用户悬停在工作流卡片上 **THEN** 系统应显示悬停效果动画
**WHEN** 用户点击工作流卡片 **THEN** 系统应跳转到对应的工作流页面

### 2. 报价工作流系统需求

#### R2.1 页面加载需求
**WHEN** 用户点击报价工作流入口 **THEN** 系统应显示独立的报价工作流页面

#### R2.2 文本输入需求
**WHEN** 报价工作流页面加载完成 **THEN** 系统应提供大型多行文本输入框

#### R2.3 处理请求需求
**WHEN** 用户输入文本内容并点击处理按钮 **IF** 输入内容不为空 **THEN** 系统应调用报价工作流API (workflow_id: 7560945341966483502)

#### R2.4 结果显示需求
**WHEN** API调用成功返回结果 **THEN** 系统应在结果展示区域显示格式化的处理结果

#### R2.5 错误处理需求
**WHEN** API调用失败 **THEN** 系统应显示用户友好的错误提示信息
**WHEN** 用户提交空内容 **THEN** 系统应提示用户输入内容

### 3. Excel文件处理工作流需求

#### R3.1 页面加载需求
**WHEN** 用户点击Excel工作流入口 **THEN** 系统应显示独立的Excel文件处理页面

#### R3.2 文件上传界面需求
**WHEN** Excel工作流页面加载完成 **THEN** 系统应提供文件上传区域，支持拖拽和点击选择

#### R3.3 文件类型验证需求
**WHEN** 用户选择或拖拽文件 **IF** 文件格式为.xlsx或.xls **THEN** 系统应接受文件
**WHEN** 用户选择或拖拽文件 **IF** 文件格式不是Excel格式 **THEN** 系统应显示文件格式错误提示

#### R3.4 文件上传处理需求
**WHEN** 用户上传有效Excel文件 **THEN** 系统应：
1. 调用文件上传API获取file_id
2. 将file_id以JSON格式传递给Excel工作流API (workflow_id: 7562027540538408996)
3. 显示处理进度指示器

#### R3.5 Excel结果展示需求
**WHEN** Excel工作流API返回处理结果 **THEN** 系统应：
1. 将API字段名映射为中文列名
2. 按预设顺序显示表格列
3. 格式化数字和特殊字段
4. 提供表格滚动功能

### 4. 物料查询工作流需求

#### R4.1 页面加载需求
**WHEN** 用户点击物料查询工作流入口 **THEN** 系统应显示独立的物料查询页面

#### R4.2 查询输入需求
**WHEN** 物料查询页面加载完成 **THEN** 系统应提供文本输入框用于物料查询

#### R4.3 查询处理需求
**WHEN** 用户输入查询内容并点击查询按钮 **IF** 输入内容不为空 **THEN** 系统应调用物料查询工作流API (workflow_id: 7553278219114971136)

#### R4.4 查询结果显示需求
**WHEN** 物料查询API返回结果 **THEN** 系统应显示增强版表格，包含UID复制功能

### 5. 数据操作功能需求

#### R5.1 复制功能需求
**WHEN** 系统显示处理结果 **THEN** 系统应提供复制按钮
**WHEN** 用户点击复制按钮 **THEN** 系统应将结果内容复制到剪贴板并显示成功提示

#### R5.2 下载功能需求
**WHEN** 系统显示处理结果 **THEN** 系统应提供下载按钮
**WHEN** 用户点击下载按钮 **THEN** 系统应生成带时间戳的文件名并下载结果内容

#### R5.3 Excel下载优化需求
**WHEN** 系统显示Excel工作流结果 **THEN** 系统应提供Excel格式下载选项
**WHEN** 用户选择Excel下载 **THEN** 系统应：
1. 保持列顺序一致性
2. 应用中文列名映射
3. 设置专业字体样式
4. 应用智能列宽设置
5. 添加表格边框和格式

#### R5.4 UID复制功能需求
**WHEN** 系统显示包含UID的表格结果 **THEN** 系统应提供UID选择和复制功能
**WHEN** 用户选择一个或多个UID **THEN** 系统应高亮显示选中状态
**WHEN** 用户点击复制UID按钮 **IF** 已选择UID **THEN** 系统应复制选中的UID到剪贴板
**WHEN** 用户点击复制UID按钮 **IF** 未选择任何UID **THEN** 系统应显示警告提示

### 6. 全屏详细查看功能需求

#### R6.1 详细查看触发需求
**WHEN** 系统显示处理结果 **THEN** 系统应提供"详细查看"按钮
**WHEN** 用户点击"详细查看"按钮 **THEN** 系统应打开全屏模态框显示完整结果

#### R6.2 模态框交互需求
**WHEN** 全屏模态框打开 **THEN** 系统应支持以下交互：
- 滚动查看长内容
- ESC键关闭
- 点击遮罩关闭
- 点击关闭按钮关闭

#### R6.3 模态框内操作需求
**WHEN** 全屏模态框显示内容 **THEN** 系统应在模态框内提供复制和下载功能

### 7. API连接测试功能需求

#### R7.1 连接测试需求
**WHEN** 系统加载完成 **THEN** 系统应提供API连接测试功能
**WHEN** 用户触发API测试 **THEN** 系统应测试API连通性并显示连接状态

#### R7.2 测试数据功能需求
**WHEN** 系统提供测试功能 **THEN** 系统应包含一键添加测试数据的功能
**WHEN** 用户点击测试数据按钮 **THEN** 系统应在输入框中填入示例数据

### 8. 响应式设计需求

#### R8.1 移动端适配需求
**WHEN** 用户在移动设备上访问应用 **THEN** 系统应自动适配移动端布局

#### R8.2 触摸交互需求
**WHEN** 用户在触摸设备上操作 **THEN** 系统应提供触摸友好的按钮和交互区域

#### R8.3 屏幕尺寸适配需求
**WHEN** 用户在不同尺寸屏幕上访问应用 **THEN** 系统应自动调整布局以适配屏幕尺寸

### 9. 错误处理和用户反馈需求

#### R9.1 网络错误处理需求
**WHEN** API调用遇到网络错误 **THEN** 系统应显示网络连接失败提示

#### R9.2 认证错误处理需求
**WHEN** API调用返回401认证错误 **THEN** 系统应显示API认证失败提示

#### R9.3 服务器错误处理需求
**WHEN** API调用返回5xx服务器错误 **THEN** 系统应显示服务器错误提示并建议稍后重试

#### R9.4 用户操作反馈需求
**WHEN** 用户执行任何操作 **THEN** 系统应提供即时的视觉反馈
**WHEN** 操作成功完成 **THEN** 系统应显示成功提示
**WHEN** 操作失败 **THEN** 系统应显示具体的错误信息

### 10. 性能和优化需求

#### R10.1 加载性能需求
**WHEN** 用户访问任何页面 **THEN** 系统应在3秒内完成页面加载

#### R10.2 大数据处理需求
**WHEN** 系统处理包含大量数据的结果 **THEN** 系统应：
1. 实现分批渲染避免界面卡顿
2. 提供流畅的滚动体验
3. 优化内存使用

#### R10.3 缓存优化需求
**WHEN** 系统处理重复查询 **IF** 查询结果在缓存有效期内 **THEN** 系统应返回缓存结果以提高响应速度

## 技术实现约束

### 约束条件
1. **纯静态实现**: 系统必须能够在纯静态环境中运行，不依赖后端服务器
2. **浏览器兼容性**: 系统必须支持主流现代浏览器
3. **移动端优先**: 系统设计必须优先考虑移动端用户体验
4. **API依赖**: 系统功能完全依赖于Coze工作流API的可用性
5. **安全性**: 系统不得在客户端存储敏感信息，API Token仅用于演示

### 非功能性需求
1. **可用性**: 界面简洁直观，用户无需培训即可使用
2. **可靠性**: 系统应具备完善的错误处理和恢复机制
3. **可维护性**: 代码结构清晰，功能模块化，易于维护和扩展
4. **性能**: 系统响应时间应在用户可接受范围内
5. **兼容性**: 支持各种设备和浏览器环境

## 项目状态说明

### 当前实现状态
- ✅ 主界面导航系统已完成
- ✅ 报价工作流系统已完成
- ✅ Excel文件处理工作流已完成
- ✅ 物料查询工作流已完成
- ✅ 数据操作功能已完成
- ✅ 全屏详细查看功能已完成
- ✅ API连接测试功能已完成
- ✅ 响应式设计已完成
- ✅ 错误处理和用户反馈已完成
- ✅ 性能优化已完成

### 技术栈
- **前端**: HTML5 + CSS3 + JavaScript (原生)
- **API集成**: Coze工作流API
- **外部库**: JSZip (用于批量下载)
- **部署**: 静态文件托管

### 部署方式
- **本地开发**: Python HTTP服务器 (python -m http.server 8000)
- **生产部署**: 支持GitHub Pages、Netlify、Vercel等静态托管平台

## 用户界面设计需求 (EARS语法)

### 11. 视觉设计需求

#### R11.1 科技感风格需求
**WHEN** 系统加载任何页面 **THEN** 系统应应用科技感设计风格，包括：
- 深色主题配色方案
- 现代化字体 (Segoe UI, Microsoft YaHei等)
- 渐变背景和阴影效果
- 流畅的过渡动画

#### R11.2 卡片设计需求
**WHEN** 系统显示功能入口 **THEN** 系统应使用卡片式设计，包含：
- 圆角边框 (border-radius: 15px)
- 阴影效果增强立体感
- 悬停时的上移动画效果
- 清晰的功能描述文本

#### R11.3 按钮设计需求
**WHEN** 系统显示操作按钮 **THEN** 系统应应用统一的按钮样式：
- 渐变背景色
- 圆角设计
- 悬停时的颜色变化
- 点击时的反馈效果

### 12. 布局和响应式需求

#### R12.1 主布局需求
**WHEN** 系统在桌面端显示 **THEN** 系统应使用居中布局，最大宽度1200px
**WHEN** 系统在移动端显示 **THEN** 系统应使用全宽布局，适配屏幕宽度

#### R12.2 网格布局需求
**WHEN** 系统显示多个卡片 **THEN** 系统应使用响应式网格布局：
- 桌面端：3列布局
- 平板端：2列布局  
- 移动端：1列布局

#### R12.3 间距和对齐需求
**WHEN** 系统显示任何界面元素 **THEN** 系统应保持一致的间距和对齐：
- 标准间距：8px, 16px, 24px, 32px
- 文本左对齐，按钮居中对齐
- 卡片间距保持一致

### 13. 交互动画需求

#### R13.1 悬停效果需求
**WHEN** 用户悬停在可交互元素上 **THEN** 系统应显示悬停效果：
- 卡片：上移2px + 阴影增强
- 按钮：背景色渐变变化
- 链接：颜色变化

#### R13.2 过渡动画需求
**WHEN** 界面元素状态发生变化 **THEN** 系统应应用平滑过渡动画：
- 过渡时间：0.3秒
- 缓动函数：ease-in-out
- 支持transform和opacity变化

#### R13.3 加载动画需求
**WHEN** 系统处理用户请求 **THEN** 系统应显示加载指示器：
- 旋转动画的加载图标
- 进度条（如适用）
- 加载文本提示

### 14. 表格和数据展示需求

#### R14.1 表格样式需求
**WHEN** 系统显示数据表格 **THEN** 系统应应用专业表格样式：
- 斑马纹行背景
- 表头固定样式
- 边框和分隔线
- 响应式横向滚动

#### R14.2 数据格式化需求
**WHEN** 系统显示数值数据 **THEN** 系统应根据数据类型应用格式化：
- 价格：保留2位小数，添加货币符号
- 数量：整数显示
- UID：等宽字体显示
- 日期：标准日期格式

#### R14.3 表格交互需求
**WHEN** 用户与表格交互 **THEN** 系统应提供以下交互功能：
- 行悬停高亮
- 可选择行（如适用）
- 排序功能（如适用）
- 列宽自适应

### 15. 模态框和弹窗需求

#### R15.1 模态框样式需求
**WHEN** 系统显示模态框 **THEN** 系统应应用统一的模态框样式：
- 半透明遮罩背景
- 居中显示的内容区域
- 圆角和阴影效果
- 响应式尺寸调整

#### R15.2 模态框动画需求
**WHEN** 模态框打开或关闭 **THEN** 系统应显示平滑的动画效果：
- 淡入淡出效果
- 缩放动画
- 背景模糊效果

#### R15.3 通知提示需求
**WHEN** 系统需要显示通知 **THEN** 系统应使用Toast通知样式：
- 右上角固定位置
- 自动消失（3-5秒）
- 不同类型的颜色区分（成功/警告/错误）
- 滑入滑出动画

### 16. 字体和文本需求

#### R16.1 字体层级需求
**WHEN** 系统显示文本内容 **THEN** 系统应使用清晰的字体层级：
- 主标题：24px, 粗体
- 副标题：20px, 半粗体
- 正文：16px, 常规
- 说明文字：14px, 常规
- 小字：12px, 常规

#### R16.2 字体选择需求
**WHEN** 系统渲染文本 **THEN** 系统应使用优化的字体栈：
- 英文：'Segoe UI', Tahoma, Geneva, Verdana, sans-serif
- 中文：'Microsoft YaHei', 'PingFang SC', 'Hiragino Sans GB'
- 代码：'Consolas', 'Monaco', 'Courier New', monospace

#### R16.3 文本可读性需求
**WHEN** 系统显示任何文本 **THEN** 系统应确保文本可读性：
- 足够的对比度（至少4.5:1）
- 适当的行高（1.4-1.6倍）
- 合理的段落间距
- 避免过长的行宽

### 17. 颜色和主题需求

#### R17.1 主色调需求
**WHEN** 系统应用颜色方案 **THEN** 系统应使用一致的主色调：
- 主色：蓝色系 (#007bff, #0056b3)
- 辅助色：灰色系 (#6c757d, #495057)
- 成功色：绿色 (#28a745)
- 警告色：橙色 (#ffc107)
- 错误色：红色 (#dc3545)

#### R17.2 背景色需求
**WHEN** 系统显示界面背景 **THEN** 系统应使用渐变背景：
- 主背景：线性渐变 (135deg, #667eea 0%, #764ba2 100%)
- 卡片背景：白色或半透明白色
- 输入框背景：浅灰色 (#f8f9fa)

#### R17.3 状态颜色需求
**WHEN** 系统显示不同状态 **THEN** 系统应使用对应的状态颜色：
- 正常状态：主色调
- 悬停状态：主色调加深
- 激活状态：主色调高亮
- 禁用状态：灰色

## 技术实现细节 (保持原有API配置)

### API集成实现
所有API配置和技术实现细节保持与原文档完全一致，包括：
- Coze工作流API配置
- 文件上传API配置
- 错误处理机制
- 数据格式化逻辑
- 缓存策略
- 性能优化方案

### 核心函数列表
保持原有的所有核心函数实现：
- `callCozeWorkflowAPI()` - API调用核心函数
- `formatCozeResponse()` - 数据格式化函数
- `formatExcelMaterialTable()` - Excel表格格式化
- `downloadExcelFile()` - Excel下载功能
- `showNotification()` - 通知提示函数
- `setupExcelDragAndDrop()` - 拖拽上传功能
- 以及所有其他已实现的功能函数

---

**文档版本**: EARS语法版本 v1.0  
**最后更新**: 2025-01-27  
**项目状态**: 功能完整，可直接使用  
**API状态**: 已配置并测试通过  
**部署方式**: 静态文件，支持多种托管平台  
**EARS转换**: 完整转换所有功能和界面需求为EARS语法格式